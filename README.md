# Cloud-Based File Storage System

## Deployment
We deploy the system with Docker and Docker Compose. Using Compose, we define the multi-container stack and connect Locust, Grafana, and Prometheus to Nextcloud. By editing `docker-compose.yml`, you can swap the database backend and modify Nextcloud settings.

To run the docker containers just go to the directory that contains the `docker-compose.yml` file and run the following command:
```
docker-compose up -d
```

## Monitoring with Grafana
To monitor performance, we run three extra containers: Grafana (a visualization tool), Prometheus (which acts as Grafanaâ€™s data source), and Nextcloud Exporter (which works as a bridge between Nextcloud and Prometheus).
After bringing them up with Docker Compose, open Grafana at `http://localhost:3000`, log in, and add a Prometheus data source. Set the Prometheus server to `http://localhost:9090` and make sure everything is up.Once the data source is saved and healthy, create your dashboard in the Grafana UI or import an existing `.json` dashboard file.

I found a pretty nice dashboard on the Grafana official web site and I decided to import that one. When the dashboard is connected you can see various metrics, this is how the one I imported looks:

<img src="images/dashboard.png" alt="Description" width="850"/>


## Perfomance Evaluation

To assess the performance of the file storage system, we created files of different sizes using the `dd` command. We then uploaded these files to, and downloaded them from, the system while measuring the time to complete each operation. The script used for these tests is provided in `upload_and_download.sh`.

The following plots report the elapsed time for download and upload as a function of the file size. 



<img src="images/size_vs_time_curl.png" alt="Description" width="500"/>


## Locust Testing

To permit traffic generated by the
Locust client to reach Nextcloud, we firstly need to add the locust container hostname to the trusted domains.

```
docker exec --user www-data nextcloud /var/www/html/occ config:system:set trusted_domains 1 --value=nextcloud
```

For my experiments on Nextcloud, I created 30 test users by running the `add_nextcloud_users.sh` script like this:

```
sh add_nextcloud_users.sh
```

I implemented a set of simple tasks in `tasks.py` file to exercise common operations like create new files of different sizes, read a user file content, upload a text file and request a list of all the files owned by the user.

To check the performances we can use the Locust web UI from `http://localhost:8089/`.

I include two charts from runs on my MacBook Air M1, spawning 10 and 30 concurrent users, respectively. For each task we record request latency and requests per second.


<img src="images/locust_10_users.png" alt="Description" width="500"/>
<img src="images/locust_30_users.png" alt="Description" width="500"/>






